{% extends 'ehr/base.html' %}

{% block title %}
    {% if form.instance.pk %}Edit{% else %}Add{% endif %} Patient
{% endblock %}

{% block content %}
<style>
    :root {
        --bg-primary: #030817;
        --bg-secondary: #0b1120;
        --accent-color: #2ec8a6;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
    }

    body {
        background-color: var(--bg-secondary);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: var(--text-primary);
    }

    .form-container {
        max-width: 700px;
        margin: 40px auto;
        padding: 20px;
    }

    .icon-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .icon-header svg {
        width: 60px;
        height: 60px;
        fill: var(--accent-color);
    }

    .form-title {
        text-align: center;
        font-size: 1.6rem;
        font-weight: bold;
        margin-bottom: 25px;
    }

    label.form-label {
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 5px;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #3c4451;
        border-radius: 10px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        transition: all 0.3s ease-in-out;
    }

    input:focus, select:focus, textarea:focus {
        border-color: var(--accent-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(46, 200, 166, 0.3);
        background-color: var(--bg-primary);
    }

    .invalid-feedback {
        font-size: 0.875rem;
        color: #ff6b6b;
        margin-top: 5px;
    }

    .text-muted {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 500;
        transition: background-color 0.3s ease;
    }

    .btn-primary {
        background-color: var(--accent-color);
        border: none;
        color: var(--text-primary);
    }

    .btn-primary:hover {
        background-color: #25a38a;
    }

    .btn-secondary {
        background-color: #6c757d;
        border: none;
        color: white;
    }

    .btn-secondary:hover {
        background-color: #565e64;
    }

    @media (max-width: 768px) {
        .row .col-md-6 {
            margin-bottom: 15px;
        }

        .d-flex.justify-content-between {
            flex-direction: column;
        }

        .d-flex.justify-content-between .btn {
            width: 100%;
            margin-bottom: 10px;
        }
    }
    .alert {
    padding: 12px 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    font-weight: 500;
    transition: opacity 0.5s ease-out;
    text-align: center;
}

.alert-success {
    background-color: #2ec8a6;
    color: #ffffff;
}

</style>

<div class="form-container">
    {% if messages %}
    <div id="message-container">
      {% for message in messages %}
        <div class="alert alert-success">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
  
    <div class="icon-header">
        <!-- SVG Icon (patient/person) -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 12c2.67 0 8 1.34 8 4v3H4v-3c0-2.66 5.33-4 8-4zm0-2c-1.66 0-3-1.34-3-3s1.34-3 
            3-3 3 1.34 3 3-1.34 3-3 3z"/>
        </svg>
    </div>

    <h2 class="form-title">{% if form.instance.pk %}Edit{% else %}Add New{% endif %} Patient</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">First Name</label>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                    <div class="invalid-feedback d-block">{{ form.first_name.errors.as_text }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                <label class="form-label">Last Name</label>
                {{ form.last_name }}
                {% if form.last_name.errors %}
                    <div class="invalid-feedback d-block">{{ form.last_name.errors.as_text }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">Date of Birth</label>
                {{ form.date_of_birth }}
                {% if form.date_of_birth.errors %}
                    <div class="invalid-feedback d-block">{{ form.date_of_birth.errors.as_text }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                <label class="form-label">Gender</label>
                {{ form.gender }}
                {% if form.gender.errors %}
                    <div class="invalid-feedback d-block">{{ form.gender.errors.as_text }}</div>
                {% endif %}
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Address</label>
            {{ form.address }}
            {% if form.address.errors %}
                <div class="invalid-feedback d-block">{{ form.address.errors.as_text }}</div>
            {% endif %}
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">Phone Number</label>
                {{ form.phone_number }}
                {% if form.phone_number.errors %}
                    <div class="invalid-feedback d-block">{{ form.phone_number.errors.as_text }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                <label class="form-label">Blood Type</label>
                {{ form.blood_type }}
                {% if form.blood_type.errors %}
                    <div class="invalid-feedback d-block">{{ form.blood_type.errors.as_text }}</div>
                {% endif %}
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">Emergency Contact</label>
                {{ form.emergency_contact }}
                {% if form.emergency_contact.errors %}
                    <div class="invalid-feedback d-block">{{ form.emergency_contact.errors.as_text }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                <label class="form-label">Emergency Phone</label>
                {{ form.emergency_phone }}
                {% if form.emergency_phone.errors %}
                    <div class="invalid-feedback d-block">{{ form.emergency_phone.errors.as_text }}</div>
                {% endif %}
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">User Account (optional)</label>
            {{ form.user }}
            {% if form.user.errors %}
                <div class="invalid-feedback d-block">{{ form.user.errors.as_text }}</div>
            {% endif %}
            <small class="text-muted">Link this patient to an existing user account</small>
        </div>

        <div class="d-flex justify-content-between">
            <a href="{% if form.instance.pk %}{% url 'patient_detail' form.instance.pk %}{% else %}{% url 'patient_list' %}{% endif %}" class="btn btn-secondary">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                {% if form.instance.pk %}Update{% else %}Create{% endif %} Patient
            </button>
        </div>
    </form>
</div>


{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateFields = document.querySelectorAll('input[type="date"]');
        dateFields.forEach(field => {
            if (!field.value && field.id.includes('date')) {
                field.valueAsDate = new Date();
            }
        });
    });


    document.addEventListener('DOMContentLoaded', function() {
        // Set today's date for empty date fields
        const dateFields = document.querySelectorAll('input[type="date"]');
        dateFields.forEach(field => {
            if (!field.value && field.id.includes('date')) {
                field.valueAsDate = new Date();
            }
        });

        // Auto-hide messages after 3 seconds
        const msgContainer = document.getElementById('message-container');
        if (msgContainer) {
            setTimeout(() => {
                msgContainer.style.opacity = '0';
                setTimeout(() => msgContainer.remove(), 500); // wait for fade out
            }, 3000); // show for 3s
        }
    });
</script>
{% endblock %}
